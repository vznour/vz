function parseDate(e){return s=e.split("-"),date=new Date(s[0],s[1]-1,s[2]),date}function combineDicts(e,t){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])}function getNodeForName(e,t){for(var a=0;a<t.length;a++){var r=t[a];if(r.n==e)return r}return!1}function hc(e){return e>=.4?"positive":e>=-.4?"neutral":"negative"}function highlight_text(e,t,a,r){return c=hc(a),r.slice(0,e)+'<span class="'+c+'">'+r.slice(e,t)+"</span>"+r.slice(t,r.length)}function getFormattedDoc(e){for(var t=rawData[e.docid],a=e.sents,r=[],n=t.v,i=a.length,o=0;i>o;o++){for(var s=r.length,l=!0,c=0;s>c;c++)if(r[c][0]==a[o][0]){if(r[c][1]<a[o][1]){var u=r.indexOf(r[c]);r.splice(u,1);break}l=!1}1==l&&r.push(a[o])}r.sort(function(e,t){return t[0]-e[0]});for(var d=[[-1,-1]],g=[],f=0;f<r.length;f++)g=r[f],start=g[0],end=g[1],senti=g[2],end>d[0]&&(end=d[0]),end>n.length&&(end=n.length),d=g,n=highlight_text(start,end,senti,n);return{text:n,gid:t.g,url:t.u,sentiment:t.s,rating:t.r,os:t.o,browser:t.b,date:t.d,ip:t.ip}}function getRawData(e){allResult=[],mapping={};for(var t in e)if(e.hasOwnProperty(t)){mapping.docid=t,mapping.sents=e[t];var a=getFormattedDoc(mapping);allResult.push(a)}return allResult}function getRawDataForAll(){return getRawData(allSentences)}function getRawDataForNode(e){return getRawData(modelSentences[e.i])}function getRawData2(e,t){t=t[e.i],allResult=[];var a=t.length;mapping={};for(var r=0;a>r;r++){doc=t[r],mapping.docid=doc,mapping.sents=allSentences[doc];var n=getFormattedDoc(mapping);allResult.push(n)}return allResult}function getRawDataForURL(e){return getRawData2(e,urlDocs)}function getBrowserData(e){return getRawData2(e,browserDocs)}function getOSData(e){return getRawData2(e,OSDocs)}function getTrendData(e){var t,a=[];switch(e.t){case MENU_TYPE.MODEL_ROOT:t=allTrend,a=modelTrend;break;case MENU_TYPE.CATEGORY:t=modelTrend[e.i],a=modelTrend;break;case MENU_TYPE.SUBCATEGORY:t=modelTrend[e.i];break;case MENU_TYPE.URL_ROOT:t=allTrend,a=urlTrend;break;case MENU_TYPE.DOMAIN:t=urlTrend[e.i],a=urlTrend;break;case MENU_TYPE.PAGE:t=urlTrend[e.i];break;case MENU_TYPE.BROWSER_ROOT:t=allTrend,a=browserTrend;break;case MENU_TYPE.BROWSER:t=browserTrend[e.i];break;case MENU_TYPE.OS_ROOT:t=allTrend,a=OSTrend;break;case MENU_TYPE.OS:t=OSTrend[e.i]}return[t,a]}function getTrend(e){var t=e.c,a={},r={},n=allTrend,i=[],o=getTrendData(e);n=o[0],i=o[1];var s=0;t&&(s=t.length);var l=n.length;if(s>0){a[e.n]={type:"bar",values:[],key:"Total",yAxis:1},r[e.n]={type:"bar",values:[],key:"Average Rating",yAxis:1};for(var c=0;s>c;c++)a[t[c].n]={type:"line",values:[],key:t[c].n,yAxis:1},r[t[c].n]={type:"line",values:[],key:t[c].n,yAxis:1}}else a[e.n]={type:"bar",values:[],key:"Total",yAxis:1},r[e.n]={type:"bar",values:[],key:"Average Rating",yAxis:1};for(var u=0;l>u;u++){var d=parseDate(n[u][0]);if(a[e.n].values.push([d,n[u][1]]),r[e.n].values.push([d,n[u][2]]),s>0)for(var g=0;s>g;g++){var f=i[t[g].i][u][1],p=i[t[g].i][u][2];a[t[g].n].values.push([d,f]),r[t[g].n].values.push([d,p])}}var T=[],E=[];for(var O in a)a.hasOwnProperty(O)&&T.push(a[O]),E.push(r[O]);return[T,E]}MENU_TYPE={MODEL_ROOT:1,CATEGORY:2,SUBCATEGORY:3,URL_ROOT:4,DOMAIN:5,PAGE:6,BROWSER:7,OS:8,OS_ROOT:9,BROWSER_ROOT:10,ALL:100},app=angular.module("voc",["treeControl","ngMaterial","angularUtils.directives.dirPagination","nvd3"]),app.config(function(e){e.theme("default")}),app.controller("vocController",["$scope","$timeout","$mdSidenav","$element",function(e,t,a,r){e.treeOptions={nodeChildren:"c",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.first=!0,e.menu=menuData,e.more=!1,e.currentPage=1,e.pageSize="5",e.reverse=!1,e.sortByName="rating",e.searchField="text",e.search={text:"",url:"",browser:"",os:"",rating:""},e.searchBy=function(t,a){var r=e.search[a],n={text:"",url:"",browser:"",os:"",rating:""};n[t]=r,e.search=n},e.getRatingClass=function(e){return 1==e?"rating1":4>e?"rating23":"rating45"},e.toggleMenu=function(){a("left").toggle()},e.data={};var n=["#1f77b4","#d62728","#ff7f0e","#2ca02c","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];e.expandedNodes=[e.menu[0]],e.options_v={chart:{type:"multiChart",height:450,margin:{top:30,right:60,bottom:50,left:70},color:n,useInteractiveGuideline:!0,transitionDuration:500,x:function(e){return e[0]},y:function(e){return e[1]},xAxis:{axisLabel:"Date",tickFormat:function(e){return e?d3.time.format("%x")(new Date(e)):null}},yAxis1:{tickFormat:function(e){return d3.format("d")(e)}},yAxis2:{tickFormat:function(e){return d3.format(",.1f")(e)}}}},e.options_r={chart:{type:"multiChart",height:450,margin:{top:30,right:60,bottom:50,left:70},color:n,useInteractiveGuideline:!0,x:function(e){return e[0]},y:function(e){return e[1]},xAxis:{axisLabel:"Date",tickFormat:function(e){return e?d3.time.format("%x")(new Date(e)):null}},yAxis1:{tickFormat:function(e){return d3.format(",.1f")(e)}}}},e.showSelected=function(t){switch(e.node1=t,e.docs=[],t.t){case MENU_TYPE.MODEL_ROOT:case MENU_TYPE.URL_ROOT:case MENU_TYPE.OS_ROOT:case MENU_TYPE.BROWSER_ROOT:e.docs=getRawDataForAll();break;case MENU_TYPE.CATEGORY:case MENU_TYPE.SUBCATEGORY:"CX"!=t.n?e.docs=getRawDataForNode(t):e.docs=getRawDataForAll();break;case MENU_TYPE.DOMAIN:case MENU_TYPE.PAGE:e.docs=getRawDataForURL(t);break;case MENU_TYPE.BROWSER:e.docs=getBrowserData(t);break;case MENU_TYPE.OS:e.docs=getOSData(t)}var a=getTrend(t);e.vdata=[a[0]],e.rdata=[a[1]];var n=r[0].querySelector("md-tab-content#tab-content-0");n.scrollTop=0,e.currentPage=1,0==e.first?e.toggleMenu():e.first=!1},t(function(){e.node1=e.menu[0],e.showSelected(e.node1)},300)}]),app.filter("trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]);
